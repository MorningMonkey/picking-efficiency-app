# ピッキング効率化アプリ 要件定義書 (V1.0)

## 1. プロジェクトの前提

### 1-1. プロジェクト基本情報

| 項目           | 内容                                                             | 補足                                                    |
| -------------- | ---------------------------------------------------------------- | ------------------------------------------------------- |
| プロジェクト名 | ピッキング効率化アプリ                                           |                                                         |
| 目的           | ピッキング業務の効率化・標準化・ミス削減                         | 誤ピック・数量ミス・棚順のムダ移動を削減する            |
| 対象業務       | ピッキング、梱包前ダブルチェック、注文別検品、出荷ステータス管理 |                                                         |
| 技術スタック   | Backend: Django (Python) / DB: PostgreSQL(本番), SQLite(開発)    | Django ORM を利用 :contentReference[oaicite:0]{index=0} |
| フロントエンド | HTML5 + Bootstrap 5 ベースの Web UI                              | モバイルブラウザ / タブレット利用前提                   |
| バーコード入力 | 外付けバーコードリーダ（HID, キーボード入力扱い）                | 将来カメラ読み取りへの拡張余地あり                      |

### 1-2. ロールと利用端末・責務

| ロール            | 利用端末                    | 主な責務                                                                               | 権限レベル                                                           |
| ----------------- | --------------------------- | -------------------------------------------------------------------------------------- | -------------------------------------------------------------------- |
| 本社・受注担当    | PC / タブレット             | 顧客・製品マスタ管理、受注(Order)登録・修正。倉庫へ「確定注文」だけを流す。            | マスタ・注文編集権限                                                 |
| ピッカー (Picker) | ハンディターミナル / スマホ | ピッキング実行、バーコードスキャンにより `qty_picked` を更新。                         | ピック実績更新のみ                                                   |
| パッカー (Packer) | PC / タブレット             | 梱包前照合（リスト単位）、注文別検品、バーコードスキャンにより `qty_verified` を更新。 | 検品実績更新のみ                                                     |
| 倉庫管理者        | PC / タブレット             | 作業進捗・エラー率・出荷状況のモニタリング。                                           | 閲覧・一部マスタ閲覧           :contentReference[oaicite:1]{index=1} |

### 1-3. 業務フロー（6ステップのコア要件）

1. **ステップ1：ピッキング実行（ピッカー）**  
   - ピッキングリストに従い棚を回り、バーコードスキャンで `qty_picked` を +1。
2. **ステップ2：ピッキング完了判定（システム）**  
   - リスト内の全 `PickingListItem` で `qty_picked == qty_to_pick` になれば  
     → `PickingList.status = "picking_done"`。
3. **ステップ3：梱包前ダブルチェック（リスト全体 × ピック品）【重要】**  
   - パッカーが、ピッキングリストの明細とカゴ/台車上のピック品を**リスト全体で照合**。  
   - 目視確認＋チェックボックス＋「確認完了」ボタンにより、  
     → `PickingList.status = "packing_ready"` へ。
4. **ステップ4：梱包作業開始（注文一覧表示）**  
   - `packing_ready` のピッキングリストに含まれる Order 一覧を表示。  
   - 対象注文を1つ選び、注文単位の検品へ。
5. **ステップ5：注文別ダブルチェック（検品）**  
   - Order 単位で `DoubleCheckSession` / `DoubleCheckItem` を生成。  
   - バーコードスキャンにより `qty_verified` を更新し、全明細一致で  
     → `Order.status = "verified"`。
6. **ステップ6：出荷準備完了（システム）**  
   - ピッキングリスト内の **全 Order が verified** になったタイミングで  
     → `PickingList.status = "done"` とし、出荷指示フローへ引き渡す。

---

## 2. ユーザー要件

### 2-1. ピッカー向け UI 要件（モバイル特化）

| 項目           | 要件レベル   | 内容                                                                                                         |
| -------------- | ------------ | ------------------------------------------------------------------------------------------------------------ |
| 操作性 (UX)    | 必須         | シンプルで明瞭な画面構成。片手操作を前提とし、ボタン・文字サイズは大きく。                                   |
| 視認性         | 必須         | 現在の棚番・ピック対象商品・予定数／実績数を大きく強調表示。                                                 |
| エラー防止     | 必須         | 誤品・数量超過スキャン時に即時アラート（色・メッセージ・音）を出す。再スキャンや修正導線を明確にする。       |
| 商品画像       | 任意（推奨） | 誤ピック防止のため、商品画像を表示できる領域を用意する。画像は任意項目とし、画像がない場合も運用可能にする。 |
| オフライン対応 | 任意（将来） | 倉庫内の一時的なネットワーク断を考慮し、Phase2 以降で検討する。 :contentReference[oaicite:2]{index=2}        |

### 2-2. パッカー向け UI 要件（PC / タブレット）

| 項目           | 要件レベル | 内容                                                                                                       |
| -------------- | ---------- | ---------------------------------------------------------------------------------------------------------- |
| 照合の確実性   | 必須       | 梱包前ダブルチェック画面で「リスト全体が一致していること」を宣言するチェックボックスと、パッカー名を明示。 |
| 見やすい一覧性 | 必須       | 明細行ごとに「予定数」と「実績」を並べ、OK/NGを色分け表示。NG（不足・過剰）は一目で分かるように。          |
| 検品進捗の把握 | 必須       | Order ごとに検品ステータス（未/検品中/完了）を一覧で確認できること。                                       |
| ミスの追跡性   | 必須       | どの注文・どの品目で検品 NG が発生したか、後から確認できるようにする（ログ要件と連動）。                   |

---

## 3. 機能要件

### 3-1. ピッキング関連

- ピッキングリスト一覧表示（`/warehouse/picking/`）
  - ログインユーザーが担当可能な `PickingList(status in ["new", "in_progress"])` を表示。
- ピッキング実行画面（`/warehouse/picking/<id>/`）
  - 棚番順に並んだ明細表示。
  - バーコードスキャンで `qty_picked` を +1。
  - 予定数を超える場合はエラー表示し、更新を拒否。
- ピッキング完了判定
  - 全明細で `qty_picked == qty_to_pick` → 自動で `status = "picking_done"`。

### 3-2. 梱包前ダブルチェック機能（ステップ3）【重要】

- 対象：`PickingList.status = "picking_done"` のリスト。
- 画面：R-21 梱包前ダブルチェック画面
  - ピッキングリスト全明細（商品名／予定数／ピック実績）を表示。
  - パッカーが**リスト全体と現物（カゴ・台車上のピック品）を目視照合**する工程を支援。
  - 「すべての品目と数量を確認しました」というチェックボックス＋パッカー名を入力 or 自動表示。
  - 「確認完了し、梱包準備OKにする」ボタン押下で：
    - `PickingList.status = "packing_ready"` に更新。
    - 操作ユーザーID、日時を `AuditLog` に記録。 :contentReference[oaicite:3]{index=3}

### 3-3. 注文別ダブルチェック（検品）

- 梱包対象リスト一覧（R-20）
  - `status in ["picking_done", "packing_ready"]` のピッキングリストをフィルタ表示。
- 注文別検品リスト（R-22）
  - 該当ピッキングリストに紐づく Order 一覧を表示。
  - 各 Order の検品ステータス（`new` / `verified`）を表示。
- 注文別検品実行（R-23）
  - Order 単位で `DoubleCheckSession` を生成。
  - 各明細は `DoubleCheckItem` として管理し、`qty_expected` / `qty_verified` を持つ。
  - バーコードスキャンで `qty_verified` を +1。
  - 全明細が一致 (`qty_verified == qty_expected`) したタイミングで `Order.status = "verified"`。

### 3-4. CSV インポート（Order/OrderItem）

- 本社システムからの受注データは、**CSV でインポート可能**とする（Phase1）。
- **必須カラム（初期案）**：
  - `order_number`（受注番号）
  - `order_line_no`（行番号／明細番号）
  - `product_barcode`（商品バーコード）
  - `quantity`（数量：受注数＝ピック予定数）
  - `location_code`（棚番／ロケーションコード）
- **任意カラム（あれば活用）**：
  - `customer_code`, `customer_name`, `product_code`, `product_name`, `order_date`, `remarks` など。
- CSV の項目構成は **倉庫ごとに違い得るため**、
  - システム設定 or 管理画面で「どのカラムを使うか」を切り替えられるようにする（Phase2以降）。  
  - Phase1 では上記初期案に固定し、追加仕様は `docs/csv-format.md` に分離して管理する。

---

## 4. 非機能要件（抜粋）

### 4-1. パフォーマンス

- 対象倉庫規模：中規模倉庫（1日あたり出荷 100〜500 行程度）。
- 同時接続ユーザー数：10〜30ユーザーを想定。 :contentReference[oaicite:4]{index=4}
- 画面レスポンス（主要操作）：
  - ピッキング実行画面のスキャン反応：1秒未満（理想は即時）。
  - リスト一覧・注文一覧の表示：3秒以内。

### 4-2. 信頼性・可用性

- ネットワーク断が発生した場合は：
  - 現時点では「エラー表示＋再接続」運用とし、オフラインでのバッファリングはスコープ外（将来検討）。
- データ損失防止：
  - すべてのピック／検品操作はトランザクション内で処理し、不整合があればロールバック。

### 4-3. セキュリティ

- 通信は HTTPS を前提とし、社内ネットワーク or VPN 経由での利用を想定。
- ロールごとの権限：
  - ピッカー／パッカーは実績値のみ更新可。
  - 本社担当のみマスタ・注文編集可。

---

## 5. 運用要件

- ログイン／ログアウトの運用ルールを倉庫単位で定める。
- 監査ログ（AuditLog）には、以下を最低限記録：
  - ユーザーID
  - 操作種別（ピック／検品／状態遷移）
  - 対象（Order / PickingList / 商品）
  - 操作日時
- Location（棚番）の設計・変更は **Locationマスタ** を通じて行い、
  - ルート変更時は `sort_order` の更新により対応する（DB再設計は不要とする）。

---

## 6. スコープ外（Phase1では扱わないもの）

- 本社基幹システムとのリアルタイムAPI連携
  - Phase1では CSV/Excel インポートのみを扱う。
- フルオフライン対応（ローカルキャッシュ＋後同期）
- 自動倉庫・マテハン機器との直接連携
- 高度なルート最適化アルゴリズム（Traveling Salesman Problem など）
  - Phase1では Location.sort_order に基づく単純な棚順ソートに留める。
- 多倉庫・多拠点間の在庫移動管理

---

## 7. 今後の詳細設計に引き継ぐ論点

- **CSVインポート仕様**  
  → `docs/csv-format.md` にて、カラム名・データ型・必須/任意・バリデーションを詳細化する。

- **Location（棚番）命名・ルート順ロジック**  
  → `docs/location-design.md` にて、`code / display_name / zone / aisle / rack / level / bin / sort_order` の設計と運用ルールを記述する。

- **API設計**  
  → `/api/picking/scan/`, `/api/packing/scan/` などを `docs/api-design.md` で定義する。

この要件定義 (V1.0) をベースに、  
**基本設計・詳細設計（データモデル／API）へ進む。**
